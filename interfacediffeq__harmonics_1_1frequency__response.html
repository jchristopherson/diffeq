<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>diffeq: diffeq_harmonics::frequency_response Interface Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">diffeq<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">A modern Fortran library providing an object-oriented approach to solving ordinary differential equations.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('interfacediffeq__harmonics_1_1frequency__response.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="interfacediffeq__harmonics_1_1frequency__response-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">diffeq_harmonics::frequency_response Interface Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Computes the frequency response of each equation in a system of forced differential equations.  
 <a href="interfacediffeq__harmonics_1_1frequency__response.html#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Computes the frequency response of each equation in a system of forced differential equations. </p>
<dl class="section user"><dt>Syntax 1</dt><dd>This implementation utilizes a discrete Fourier transform to estimate the frequency response functions for each equation in a system of ODE's. <div class="fragment"><div class="line"><span class="keywordtype">allocatable</span> <span class="keywordtype">complex(real64)</span>(:,:) function frequency_response ( &amp;</div>
<div class="line"> <span class="keywordtype">class</span>(forced_ode_container) sys, &amp;</div>
<div class="line"> <span class="keywordtype">real(real64)</span> span, &amp;</div>
<div class="line"> <span class="keywordtype">real(real64)</span> iv(:), &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">real(real64)</span> fs, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">class</span>(ode_integrator) solver, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">class</span>(window) win, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">allocatable</span> <span class="keywordtype">real(real64)</span> freq(:), &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">class</span>(errors) err &amp;</div>
<div class="line">)</div>
</div><!-- fragment --></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">sys</td><td>The <code><a class="el" href="structdiffeq__harmonics_1_1forced__ode__container.html">forced_ode_container</a></code> containing the system of differential equations and associated forcing function to analyze. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">span</td><td>The duration of the time analysis. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iv</td><td>An N-element array containing the initial conditions for each of the N equations. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>An optional rate at which to sample the differential equation solution. The default is 1024 Hz, assuming that <code>span</code> is provided in units of seconds. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">solver</td><td>An optional differential equation solver. The default solver is the Dormand-Prince Runge-Kutta integrator dprk45_integrator. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">win</td><td>An optional parameter allowing the differential equation solution to be windowed as part of the FFT process used to construct the system transfer functions. The default is a Hamming window sized to contain the entire solution in one window. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">freq</td><td>An optional allocatable array that, if supplied, will contain the frequency values at which the solution is provided. The units will match the units of <code>fs</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">err</td><td>An optional errors-based object that if provided can be used to retrieve information relating to any errors encountered during execution. If not provided, a default implementation of the errors class is used internally to provide error handling. Possible errors and warning messages that may be encountered are as follows.<ul>
<li>DIFFEQ_MEMORY_ALLOCATION_ERROR: Occurs if there is a memory allocation issue.</li>
<li>DIFFEQ_NULL_POINTER_ERROR: Occurs if no ODE function is defined, or if no forcing function is defined.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An M-by-N matrix containing the complex-valued frequency response functions normalized by the magnitude of the forcing function for each of the N equations in the system of ODEs.</dd></dl>
<dl class="section user"><dt>Example</dt><dd>The following example illustrates how to compute the frequency response of a single-degree-of-freedom mechanical vibrating system with a 50 Hz resonant frequency. <div class="fragment"><div class="line"><span class="keyword">program</span> example</div>
<div class="line">    <span class="keywordtype">use </span>iso_fortran_env</div>
<div class="line">    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacediffeq__harmonics.html">diffeq_harmonics</a></div>
<div class="line">    <span class="keywordtype">use </span>diffeq_models</div>
<div class="line">    <span class="keywordtype">use </span>fplot_core</div>
<div class="line">    <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Parameters</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: fmin = 1.0d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: fmax = 1.0d2</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: fs = 2.56d2</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: pi = 2.0d0 * acos(0.0d0)</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: z = 1.0d-1</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: wn = 2.0d0 * pi * 5.0d1</div>
<div class="line">    <span class="keywordtype">complex(real64)</span>, <span class="keywordtype">parameter</span> :: j = (0.0d0, 1.0d0)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Local Variables</span></div>
<div class="line">    <span class="keywordtype">type</span>(forced_ode_container) :: mdl</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">allocatable</span> :: freq(:), mag(:), phase(:), amag(:), &amp;</div>
<div class="line">        aphase(:)</div>
<div class="line">    <span class="keywordtype">complex(real64)</span>, <span class="keywordtype">allocatable</span> :: sol(:,:), tf(:), s(:)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Plot Variables</span></div>
<div class="line">    <span class="keywordtype">type</span>(multiplot) :: plt</div>
<div class="line">    <span class="keywordtype">type</span>(plot_2d) :: plt1, plt2</div>
<div class="line">    <span class="keywordtype">type</span>(plot_data_2d) :: pd1, pd2</div>
<div class="line">    <span class="keywordtype">class</span>(plot_axis), <span class="keywordtype">pointer</span> :: xAxis, yAxis</div>
<div class="line">    <span class="keywordtype">class</span>(legend), <span class="keywordtype">pointer</span> :: lgnd</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Define the model</span></div>
<div class="line">    mdl%fcn =&gt; example_2nd_order</div>
<div class="line">    mdl%forcing_function =&gt; example_2nd_order_forcing</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Compute the FRF&#39;s</span></div>
<div class="line">    sol = <a class="code hl_interface" href="interfacediffeq__harmonics_1_1frequency__response.html">frequency_response</a>(mdl, 5.0d0, [0.0d0, 0.0d0], freq = freq)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Compute the magnitude and phase</span></div>
<div class="line">    mag = 2.0d1 * log10(abs(sol(:,1) / sol(1,1)))</div>
<div class="line">    phase = (1.8d2 / pi) * atan2(aimag(sol(:,1)), real(sol(:,1)))</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Compute the analytical solution</span></div>
<div class="line">    s = j * (2.0d0 * pi * freq)</div>
<div class="line">    tf = 1.0d0 / (s**2 + 2.0d0 * z * wn * s + wn**2)</div>
<div class="line">    amag = 2.0d1 * log10(abs(tf / tf(1)))</div>
<div class="line">    aphase = (1.8d2 / pi) * atan2(aimag(tf), real(tf))</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Plot the results</span></div>
<div class="line">    <span class="keyword">call </span>plt%initialize(2, 1)</div>
<div class="line">    <span class="keyword">call </span>plt1%initialize()</div>
<div class="line">    xaxis =&gt; plt1%get_x_axis()</div>
<div class="line">    yaxis =&gt; plt1%get_y_axis()</div>
<div class="line">    lgnd =&gt; plt1%get_legend()</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_title(<span class="stringliteral">&quot;f [Hz]&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>yaxis%set_title(<span class="stringliteral">&quot;|X / F| [dB]&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_autoscale(.false.)</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_limits(0.0d0, 1.0d2)</div>
<div class="line">    <span class="keyword">call </span>lgnd%set_is_visible(.true.)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd1%define_data(freq, mag)</div>
<div class="line">    <span class="keyword">call </span>pd1%set_line_width(2.0)</div>
<div class="line">    <span class="keyword">call </span>pd1%set_name(<span class="stringliteral">&quot;Numerical&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>plt1%push(pd1)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd2%define_data(freq, amag)</div>
<div class="line">    <span class="keyword">call </span>pd2%set_line_width(3.0)</div>
<div class="line">    <span class="keyword">call </span>pd2%set_line_style(line_dashed)</div>
<div class="line">    <span class="keyword">call </span>pd2%set_name(<span class="stringliteral">&quot;Analytical&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>plt1%push(pd2)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>plt2%initialize()</div>
<div class="line">    xaxis =&gt; plt2%get_x_axis()</div>
<div class="line">    yaxis =&gt; plt2%get_y_axis()</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_title(<span class="stringliteral">&quot;f [Hz]&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>yaxis%set_title(<span class="stringliteral">&quot;{/Symbol f} [rad]&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_autoscale(.false.)</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_limits(0.0d0, 1.0d2)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd1%define_data(freq, phase)</div>
<div class="line">    <span class="keyword">call </span>plt2%push(pd1)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd2%define_data(freq, aphase)</div>
<div class="line">    <span class="keyword">call </span>plt2%push(pd2)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>plt%set(1, 1, plt1)</div>
<div class="line">    <span class="keyword">call </span>plt%set(2, 1, plt2)</div>
<div class="line">    <span class="keyword">call </span>plt%draw()</div>
<div class="line"><span class="keyword">end program</span></div>
<div class="ttc" id="ainterfacediffeq__harmonics_1_1frequency__response_html"><div class="ttname"><a href="interfacediffeq__harmonics_1_1frequency__response.html">diffeq_harmonics::frequency_response</a></div><div class="ttdoc">Computes the frequency response of each equation in a system of forced differential equations.</div><div class="ttdef"><b>Definition:</b> <a href="diffeq__harmonics_8f90_source.html#l00394">diffeq_harmonics.f90:394</a></div></div>
<div class="ttc" id="anamespacediffeq__harmonics_html"><div class="ttname"><a href="namespacediffeq__harmonics.html">diffeq_harmonics</a></div><div class="ttdoc">This module contains routines for assisting in the harmonic analysis of systems of ODE's.</div><div class="ttdef"><b>Definition:</b> <a href="diffeq__harmonics_8f90_source.html#l00003">diffeq_harmonics.f90:3</a></div></div>
</div><!-- fragment --> The ODE routine and forcing function routine were stored in a seperate module; however, here is the code for these routines. <div class="fragment"><div class="line"><span class="keywordtype">pure</span> <span class="keyword">function </span>example_2nd_order_forcing(t) <span class="keyword">result</span>(rst)</div>
<div class="line">    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacediffeq__harmonics.html">diffeq_harmonics</a>, <span class="keywordtype">only</span> : chirp</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Arguments</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">intent(in)</span> :: t</div>
<div class="line"><span class="keywordtype">    real</span>(real64) :: rst</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Process</span></div>
<div class="line">    rst = chirp(t, 1.0d2, 5.0d0, 1.0d0, 1.0d2)</div>
<div class="line"><span class="keyword">end function</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">subroutine </span>example_2nd_order(t, x, dxdt)</div>
<div class="line">    <span class="comment">! Arguments</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">intent(in)</span> :: t</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(:)</span> :: x</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(:)</span> :: dxdt</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Model Parameters</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: pi = 2.0d0 * acos(0.0d0)</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: z = 1.0d-1</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: wn = 2.0d0 * pi * 5.0d1</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Local Variables</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64) :: f</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Process</span></div>
<div class="line">    f = example_2nd_order_forcing(t)</div>
<div class="line">    dxdt(1) = x(2)</div>
<div class="line">    dxdt(2) = f - (2.0d0 * z * wn * x(2) + wn**2 * x(1))</div>
<div class="line"><span class="keyword">end subroutine</span></div>
</div><!-- fragment --> The above program produces the following plot using the <a href="https://github.com/jchristopherson/fplot">FPLOT</a> library. <div class="image">
<img src="frf_example_1.png" alt=""/>
</div>
</dd></dl>
<dl class="section user"><dt>Syntax 2</dt><dd>This implementation utilizes a frequency sweeping approach to compute the frequency response function for each ODE. Frequency sweeping allows for identification of nonlinear phenomenon such as jump in the frequency response. Such phenomenon are not directly available when using linear system methods. The drawback of this method however is the potentially long solution time determined by not only the frequency resolution that is sought, but also the difficulty in solving the ODEs. <div class="fragment"><div class="line"><span class="keywordtype">allocatable</span> real(real64)(:,:) <span class="keyword">function </span>frequency_response( &amp;</div>
<div class="line"> class(harmonic_ode_container) sys, &amp;</div>
<div class="line"><span class="keywordtype"> real</span>(real64) freq(:), &amp;</div>
<div class="line"> <span class="keywordtype">real(real64)</span> iv(:), &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">class</span>(ode_integrator) solver, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">integer(int32)</span> ncycles, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">integer(int32)</span> ntransient, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">integer(int32)</span> pointspercycle, &amp;</div>
<div class="line"> <span class="keywordtype">optional</span> <span class="keywordtype">class</span>(errors) err &amp;</div>
<div class="line">)</div>
</div><!-- fragment --></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">sys</td><td>The <a class="el" href="structdiffeq__harmonics_1_1harmonic__ode__container.html">harmonic_ode_container</a> object containing the ODEs to integrate. To utilize this routine effectively you will need to inherit from the <a class="el" href="structdiffeq__harmonics_1_1harmonic__ode__container.html">harmonic_ode_container</a> type and overload the ode subroutine. Utilize the excitation_frequency property of this type in order to obtain the current frequency being analyzed by the solver. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">freq</td><td>An M-element array containing the frequency points at which the solution should be computed. Notice, whatever units are utilized for this array are also the units of the excitation_frequency property in <code>sys</code>. It is recommended that the units be set to Hz. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iv</td><td>An N-element array containing the initial conditions for each of the N ODEs. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">solver</td><td>An optional differential equation solver. The default solver is the Dormand-Prince Runge-Kutta integrator dprk45_integrator. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">An</td><td>optional parameter controlling the number of cycles to analyze when determining the amplitude and phase of the response. The default is 5. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ntransient</td><td>An optional parameter controlling how many of the initial "transient" cycles to ignore. The default is 30. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pointspercycle</td><td>An optional parameter controlling how many evenly spaced solution points should be considered per cycle. The default is 30. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">err</td><td>An optional errors-based object that if provided can be used to retrieve information relating to any errors encountered during execution. If not provided, a default implementation of the errors class is used internally to provide error handling. Possible errors and warning messages that may be encountered are as follows.<ul>
<li>DIFFEQ_MEMORY_ALLOCATION_ERROR: Occurs if there is a memory allocation issue.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An M-by-N matrix containing the complex-valued frequency response functions for each of the N equations in the system of ODEs.</dd></dl>
<dl class="section user"><dt>Example</dt><dd>The following example illustrates how to utilize this routine to determine the frequency response function for the Duffing equation. This example sweeps both ascending and descending frequencies to reveal the jump condition for the Duffing equation. Also, notice the overloading of the ode routine from the <a class="el" href="structdiffeq__harmonics_1_1harmonic__ode__container.html">harmonic_ode_container</a> type in order to define the ODE. <div class="fragment"><div class="line"><span class="keyword">module</span> ode_module</div>
<div class="line">    <span class="keywordtype">use </span>iso_fortran_env</div>
<div class="line">    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacediffeq__harmonics.html">diffeq_harmonics</a></div>
<div class="line">    <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Model Constants</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: alpha = 1.0d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: beta = 0.4d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: delta = 0.1d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: gamma = 1.0d0</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! ODE_CONTAINER object</span></div>
<div class="line">    <span class="keyword">type</span>, <span class="keyword">extends</span>(<a class="code hl_struct" href="structdiffeq__harmonics_1_1harmonic__ode__container.html">harmonic_ode_container</a>) :: duffing_ode</div>
<div class="line">    <span class="keyword">contains</span></div>
<div class="line">        <span class="comment">! Overloads the ODE subroutine providing the ability to obtain</span></div>
<div class="line">        <span class="comment">! frequency information from the solver via the excitation_frequency</span></div>
<div class="line">        <span class="comment">! property.</span></div>
<div class="line">        <span class="keywordtype">procedure</span>, <span class="keywordtype">public</span> :: ode =&gt; duffing_model</div>
<div class="line">    <span class="keyword">end type</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">contains</span></div>
<div class="line">    <span class="keyword">subroutine </span>duffing_model(this, x, y, dydx)</div>
<div class="line">        <span class="comment">! Arguments</span></div>
<div class="line">        <span class="keywordtype">class</span>(duffing_ode), <span class="keywordtype">intent(in)</span> :: this</div>
<div class="line"><span class="keywordtype">        real</span>(real64), <span class="keywordtype">intent(in)</span> :: x</div>
<div class="line"><span class="keywordtype">        real</span>(real64), <span class="keywordtype">intent(in)</span>, <span class="keywordtype">dimension(:)</span> :: y</div>
<div class="line"><span class="keywordtype">        real</span>(real64), <span class="keywordtype">intent(out)</span>, <span class="keywordtype">dimension(:)</span> :: dydx</div>
<div class="line"> </div>
<div class="line">        <span class="comment">! Equations</span></div>
<div class="line">        dydx(1) = y(2)</div>
<div class="line">        dydx(2) = gamma * cos(this%excitation_frequency * x) - &amp;</div>
<div class="line">            delta * y(2) - alpha * y(1) - beta * y(1)**3</div>
<div class="line">    <span class="keyword">end subroutine</span></div>
<div class="line"><span class="keyword">end module</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">program</span> example</div>
<div class="line">    <span class="keywordtype">use </span>iso_fortran_env</div>
<div class="line">    <span class="keywordtype">use </span>ode_module</div>
<div class="line">    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacediffeq__harmonics.html">diffeq_harmonics</a></div>
<div class="line">    <span class="keywordtype">use </span>fplot_core</div>
<div class="line">    <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Parameters</span></div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: f1 = 0.5d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: f2 = 2.5d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: df = 0.01d0</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: pi = 2.0d0 * acos(0.0d0)</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">parameter</span> :: deg = 1.8d2 / pi</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Local Variables</span></div>
<div class="line">    <span class="keywordtype">type</span>(duffing_ode) :: sys</div>
<div class="line">    <span class="keywordtype">integer(int32)</span> :: i, n</div>
<div class="line"><span class="keywordtype">    real</span>(real64), <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: fup, fdown</div>
<div class="line">    <span class="keywordtype">complex(real64)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: rup, rdown</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Plot Variables</span></div>
<div class="line">    <span class="keywordtype">type</span>(multiplot) :: plt</div>
<div class="line">    <span class="keywordtype">type</span>(plot_2d) :: plt1, plt2</div>
<div class="line">    <span class="keywordtype">type</span>(plot_data_2d) :: pd1, pd2</div>
<div class="line">    <span class="keywordtype">class</span>(plot_axis), <span class="keywordtype">pointer</span> :: xAxis, yAxis</div>
<div class="line">    <span class="keywordtype">class</span>(legend), <span class="keywordtype">pointer</span> :: lgnd</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Define the frequency vectors</span></div>
<div class="line">    n = floor((f2 - f1) / df) + 1</div>
<div class="line">    <span class="keyword">allocate</span>(fup(n), fdown(n))</div>
<div class="line">    fup = (/ (df * i + f1, i = 0, n - 1) /)</div>
<div class="line">    fdown = (/ (df * i + f1, i = n - 1, 0, -1) /)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Perform the ascending sweep</span></div>
<div class="line">    rup = <a class="code hl_interface" href="interfacediffeq__harmonics_1_1frequency__response.html">frequency_response</a>(sys, fup, [0.0d0, 0.0d0])</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Perform the descending sweep</span></div>
<div class="line">    rdown = <a class="code hl_interface" href="interfacediffeq__harmonics_1_1frequency__response.html">frequency_response</a>(sys, fdown, [0.0d0, 0.0d0])</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Plot the results</span></div>
<div class="line">    <span class="keyword">call </span>plt%initialize(2, 1)</div>
<div class="line">    <span class="keyword">call </span>plt1%initialize()</div>
<div class="line">    xaxis =&gt; plt1%get_x_axis()</div>
<div class="line">    yaxis =&gt; plt1%get_y_axis()</div>
<div class="line">    lgnd =&gt; plt1%get_legend()</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_title(<span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>yaxis%set_title(<span class="stringliteral">&quot;X(w)&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>lgnd%set_is_visible(.true.)</div>
<div class="line">    <span class="keyword">call </span>lgnd%set_horizontal_position(legend_left)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd1%define_data(fup, abs(rup(:,1)))</div>
<div class="line">    <span class="keyword">call </span>pd1%set_name(<span class="stringliteral">&quot;Ascending&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>pd1%set_line_width(2.0)</div>
<div class="line">    <span class="keyword">call </span>plt1%push(pd1)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd2%define_data(fdown, abs(rdown(:,1)))</div>
<div class="line">    <span class="keyword">call </span>pd2%set_name(<span class="stringliteral">&quot;Descending&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>pd2%set_line_width(2.0)</div>
<div class="line">    <span class="keyword">call </span>pd2%set_line_style(line_dashed)</div>
<div class="line">    <span class="keyword">call </span>plt1%push(pd2)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>plt2%initialize()</div>
<div class="line">    xaxis =&gt; plt2%get_x_axis()</div>
<div class="line">    yaxis =&gt; plt2%get_y_axis()</div>
<div class="line">    <span class="keyword">call </span>xaxis%set_title(<span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line">    <span class="keyword">call </span>yaxis%set_title(<span class="stringliteral">&quot;{/Symbol f} [deg]&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd1%define_data(fup, deg * atan2(aimag(rup(:,1)), real(rup(:,1))))</div>
<div class="line">    <span class="keyword">call </span>plt2%push(pd1)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>pd2%define_data(fdown, deg * atan2(aimag(rdown(:,1)), real(rdown(:,1))))</div>
<div class="line">    <span class="keyword">call </span>plt2%push(pd2)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>plt%set(1, 1, plt1)</div>
<div class="line">    <span class="keyword">call </span>plt%set(2, 1, plt2)</div>
<div class="line">    <span class="keyword">call </span>plt%draw()</div>
<div class="line"><span class="keyword">end program</span></div>
<div class="ttc" id="astructdiffeq__harmonics_1_1harmonic__ode__container_html"><div class="ttname"><a href="structdiffeq__harmonics_1_1harmonic__ode__container.html">diffeq_harmonics::harmonic_ode_container</a></div><div class="ttdef"><b>Definition:</b> <a href="diffeq__harmonics_8f90_source.html#l00028">diffeq_harmonics.f90:28</a></div></div>
</div><!-- fragment --> The above program produces the following plot using the <a href="https://github.com/jchristopherson/fplot">FPLOT</a> library. <div class="image">
<img src="frf_sweep_example_1.png" alt=""/>
</div>
 </dd></dl>

<p class="definition">Definition at line <a class="el" href="diffeq__harmonics_8f90_source.html#l00394">394</a> of file <a class="el" href="diffeq__harmonics_8f90_source.html">diffeq_harmonics.f90</a>.</p>
</div><hr/>The documentation for this interface was generated from the following file:<ul>
<li>D:/Code/diffeq/src/<a class="el" href="diffeq__harmonics_8f90_source.html">diffeq_harmonics.f90</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacediffeq__harmonics.html">diffeq_harmonics</a></li><li class="navelem"><a class="el" href="interfacediffeq__harmonics_1_1frequency__response.html">frequency_response</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
